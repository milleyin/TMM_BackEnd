<extend name="Base/common"/>
<block name="body">
    <div class="container gdu-container">
        <div class="row gdu-row-left-special">
            <div class="col-xs-12 col-sm-9">


                <volist name="list" id="category">
                <div class="row show-grid">
                    <div class="col-xs-special-img col-sm-7">
                        <a href="{:U('Category/detail?id='.$category['id'])}" target="_blank" class="gdu-special-cover">
                            <img src="__ROOT__{$category.icon_path}" alt="{$category.title}">
                        </a>
                    </div>
                    <div class="col-xs-4 col-xs-special-title col-sm-5">
                        <h2 class="gdu-special-title">
                            <a href="{:U('Category/detail?id='.$category['id'])}" target="_blank">{$category.title}</a>
                        </h2>
                        <div class="gdu-special-options">
                        <empty name="category.CategoryArticle">
                            <span class="gdu-article-num">0篇文章</span>
                        <else />
                            <volist name="category.CategoryArticle" id="vo" offset="0" length='1'>
                                <span class="gdu-article-num">{$vo.articleCount}篇文章</span>
                            </volist>
                        </empty>
                        </div>
                        <p class="gdu-special-info">
                            {$category.description}
                        </p>
                    </div>
                </div>
                </volist>




                <div class="row gdu-article-row" id="category_more_content">
                    <div class="col-sm-12 gdu-article-more" id="categoryLoadMore" data-page="{$pageInfo.down_page}">
                        <empty name="pageInfo.down_page">
                            <span>没有更多专题了</span>
                            <else />
                            <span>更多专题</span><span class="glyphicon glyphicon glyphicon-menu-down"></span>
                        </empty>
                    </div>
                </div>
            </div>
            <!--/.col-xs-12.col-sm-9-->
            <div class="col-xs-6 col-sm-3 sidebar-offcanvas" id="sidebar">
                <include file="Public/sidebar"/>
            </div>
            <!--/.sidebar-offcanvas-->
        </div>
        <!--/row-->
        <div class="go-top" style="display: none;"></div>
    </div>
</block>
<block name="script">
    <script id="category-template" type="text/x-handlebars-template">
        {{#each categoryList}}
        <div class="row show-grid">
            <div class="col-xs-special-img col-sm-7">
                <a href="{{../appUrl}}/home/category/detail/id/{{id}}.html" target="_blank" class="gdu-special-cover">
                    <img src="{{../rootUrl}}{{icon_path}}" alt="{{title}}">
                </a>
            </div>
            <div class="col-xs-4 col-xs-special-title col-sm-5">
                <h2 class="gdu-special-title">
                    <a href="{{../appUrl}}/home/category/detail/id/{{id}}.html" target="_blank">{{title}}</a>
                </h2>
                <div class="gdu-special-options">
                    {{#each CategoryArticle}}
                        {{#if @first}}
                            <span class="gdu-article-num">{{articleCount}}篇文章</span>
                        {{/if}}
                    {{/each}}
                </div>
                <p class="gdu-special-info">
                    {{description}}
                </p>
            </div>
        </div>
        {{/each}}
    </script>
    <script>
        $('#categoryLoadMore').on('click', function() {
            var that = this;
            // 下一页
            var nextPage = $(that).attr('data-page');
            if (nextPage == '') return ;

            $.post(nextPage).success(function(data){
                if (data.status==1) {
                    var dataRes = JSON.parse(data.info);
                    dataRes.appUrl = Think.APP;
                    var source   = $("#category-template").html();
                    var template = Handlebars.compile(source);
                    var html    = template(dataRes);
                    $('#category_more_content').before(html);
                    if (dataRes.pageInfo.down_page) {
                        $(that).attr('data-page', dataRes.pageInfo.down_page);
                    } else {
                        $(that).attr('data-page', '');
                        $(that).html('<span>没有更多文章了</span>');
                    }
                }
            });
        });
    </script>
</block>