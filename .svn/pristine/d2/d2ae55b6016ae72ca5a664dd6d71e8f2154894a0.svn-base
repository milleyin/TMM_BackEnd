<extend name="Base/back"/>
<block name="style">
    <style>
        body {
            padding-top: 50px;
        }
    </style>
</block>
<block name="body">
    <body>
    <include file="Public/back-nav"/>

    <div class="container-fluid" style="padding-top: 30px;">
        <form class="form-inline" method="get" action="{:U('Back/logistics')}">
            <div class="form-group">
                <input type="text" class="form-control" name="word" placeholder="卡券号/购票手机号" value="{$word}">
            </div>
            <div class="form-group">
                <select class="form-control" name="status">
                    <option value="" <eq name="status" value="">selected<else/></eq> >全部</option>
                    <option value="0" <eq name="status" value="0">selected<else/></eq> >未发货</option>
                    <option value="1" <eq name="status" value="1">selected<else/></eq> >已发货</option>
                </select>
            </div>
            <button type="submit" class="btn btn-default">查找</button>
        </form>
        <div class="table-responsive manage-table" style="margin-top: 10px;">
            <table class="table table-bordered table-hover">
                <thead>
                <tr>
                    <th>卡券号</th>
                    <th>购券手机号</th>
                    <th>邮寄箱数</th>
                    <th>收货人</th>
                    <th>联系电话</th>
                    <th>收货地址</th>
                    <th>是否发货</th>
                    <th>物流公司</th>
                    <th>物流单号</th>
                    <th>申请邮寄时间</th>
                    <th>发货时间</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody>

                <empty name="logisticsList">
                    <tr>
                        <td colspan="12">暂无数据...</td>
                    </tr>

                    <else />

                    <volist name="logisticsList" id="vo" >
                        <tr>
                            <td>{$vo.card_no}</td>
                            <td>{$vo.mobile}</td>
                            <td>
                                <eq name="vo.specs_id" value="1">
                                    {$vo.number}箱10斤装
                                <else />
                                    {$vo.number}箱6斤装
                                </eq>
                            </td>
                            <td>{$vo.cnee}</td>
                            <td>
                                {$vo.phone}
                            </td>
                            <td>
                                {$vo.province|getRegionName=###}{$vo.city|getRegionName=###}{$vo.area|getRegionName=###}{$vo.address}
                            </td>
                            <td>
                                <eq name="vo.is_send" value="1">
                                    已发货
                                <else />
                                    <span style="color: #d9534f;">未发货</span>
                                </eq>
                            </td>
                            <td>
                                {$vo.logistics_company|default='-'}
                            </td>
                            <td>
                                {$vo.logistics_no|default='-'}
                            </td>
                            <td>
                                {$vo.add_time|date='Y/m/d H:i:s', ###}
                            </td>
                            <td>
                                <eq name="vo.is_send" value="1">
                                    {$vo.send_time|date='Y/m/d H:i:s', ###}
                                <else />
                                    -
                                </eq>
                            </td>
                            <td>
                                <eq name="vo.is_send" value="1">
                                    -
                                <else />
                                    <a href="javascript:;" class="go-send" data-id="{$vo.id}">发货</a>
                                </eq>
                            </td>
                        </tr>
                    </volist>
                </empty>

                </tbody>
            </table>
            <nav style="text-align: center;">

                {$page}

            </nav>
        </div>
    </div>
    </body>
</block>
<block name="script">
    <script src="__STATIC__/layer/layer.js"></script>
    <script src="__STATIC__/layer/extend/layer.ext.js"></script>
    <script>
        $(function() {
            $('.go-send').on('click', function() {
                var $this = $(this);
                var dataObj = $this.data();

                layer.prompt({
                    title: '请输入物流单号',
                }, function(value, index){
                    layer.close(index);
                    if($.trim(value) == ''){
                        layer.alert("请输入物流单号!");
                    } else {
                        $.post(
                                "{:U('Back/goToSend')}",
                                {'id': dataObj.id, 'logistics_no': value},
                                function(response) {
                                    if (response.status) {
                                        layer.alert(response.prompt, function(index){
                                            layer.close(index);
                                            window.location.reload();
                                        });
                                    } else {
                                        layer.alert(response.prompt);
                                    }
                                });
                    }
                });
            });
        });
    </script>
</block>