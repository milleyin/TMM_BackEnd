<extend name="Base/common"/>

<block name="body">
    <div class="container gdu-container">
        <div class="row show-grid grid-no-border">
            <div class="col-xs-12 col-sm-12">
                <div class="gdu-special-category">
                    <img class="gdu-special-category-img" src="__ROOT__{$category.detail_cover}" alt="{$category.title}">
                    <div class="gdu-category-detail">
                        <h3>{$category.title}</h3>
                        <h5>{$category.article_count}篇文章</h5>
                        <p>
                            {$category.description}
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <div class="row gdu-row-left">
            <div class="col-xs-12 col-sm-9">
                <volist name="list" id="article">
                <div class="row show-grid">
                    <div class="col-xs-article-img col-sm-4">
                        <a href="{:U('Article/detail?id='.$article['id'])}" target="_blank" class="gdu-article-cover">
                            <img src="__ROOT__{$article.cover_path}" alt="{$article.title}">
                        </a>
                    </div>
                    <div class="col-xs-article-title col-sm-8">
                        <h2 class="gdu-title">
                            <a href="{:U('Article/detail?id='.$article['id'])}" target="_blank">{$article.title}</a>
                        </h2>
                        <div class="gdu-options">
                            <span class="gdu-time">{$article.update_time|date='Y-m-d',###}</span>
                        </div>
                        <p class="gdu-info">
                            {$article.description}
                        </p>
                    </div>
                </div>
                </volist>
                <div class="row gdu-article-row" id="category_more_content">
                    <div class="col-sm-12 gdu-article-more" id="categoryLoadMore" data-page="{$pageInfo.down_page}">
                        <empty name="pageInfo.down_page">
                            <span>没有更多文章了</span>
                            <else />
                            <span>更多文章</span><span class="glyphicon glyphicon glyphicon-menu-down"></span>
                        </empty>
                    </div>
                </div>
            </div>
            <!--/.col-xs-12.col-sm-9-->
            <div class="col-xs-6 col-sm-3 sidebar-offcanvas" id="sidebar">
                <include file="Public/sidebar"/>
            </div>
            <!--/.sidebar-offcanvas-->
        </div>
        <!--/row-->
        <div class="go-top" style="display: none;"></div>
    </div>
</block>
<block name="script">
    <script id="category-template" type="text/x-handlebars-template">
        {{#each articleList}}
        <div class="row show-grid">
            <div class="col-xs-article-img col-sm-4">
                <a href="{{../appUrl}}/home/article/detail/id/{{id}}.html" target="_blank" class="gdu-article-cover">
                    <img src="{{../rootUrl}}{{cover_path}}" alt="{{title}}">
                </a>
            </div>
            <div class="col-xs-article-title col-sm-8">
                <h2 class="gdu-title">
                    <a href="{{../appUrl}}/home/article/detail/id/{{id}}.html" target="_blank">{{title}}</a>
                </h2>
                <div class="gdu-options">
                    <span class="gdu-time">{{prettifyDate update_time}}</span>
                </div>
                <p class="gdu-info">
                    {{description}}
                </p>
            </div>
        </div>
        {{/each}}
    </script>
    <script>
        $('#categoryLoadMore').on('click', function() {
            var that = this;
            // 下一页
            var nextPage = $(that).attr('data-page');
            if (nextPage == '') return ;

            $.post(nextPage).success(function(data){
                if (data.status==1) {
                    var dataRes = JSON.parse(data.info);
                    dataRes.appUrl = Think.APP;
                    var source   = $("#category-template").html();
                    var template = Handlebars.compile(source);
                    var html    = template(dataRes);
                    $('#category_more_content').before(html);
                    if (dataRes.pageInfo.down_page) {
                        $(that).attr('data-page', dataRes.pageInfo.down_page);
                    } else {
                        $(that).attr('data-page', '');
                        $(that).html('<span>没有更多文章了</span>');
                    }
                }
            });
        });
    </script>
</block>