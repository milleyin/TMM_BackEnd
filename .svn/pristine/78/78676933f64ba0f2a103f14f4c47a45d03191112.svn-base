<?php
namespace app\controllers;

use FrontController;

/**
 * 抽奖记录控制器
 * @author Changhai Zhan
 *
 */
class RecordController extends FrontController
{
    /**
     * 当前操作模型的名称
     * @var string
     */
    public $_modelName = 'Record';
    
    /**
     * 首页 奖品记录
     */
    public function actionIndex()
    {
        $criteria = new \CDbCriteria;
        $criteria->with = array(
            'Record_User',
            'Record_Pad',
            'Record_Store',
        );
        $criteria->addColumnCondition(array(
            '`t`.`pad_id`'=> \Yii::app()->user->padId,
            '`t`.`store_id`'=> \Yii::app()->user->id,
            '`t`.`status`'=> \Record::_STATUS_NORMAL,
            '`Record_Pad`.`status`'=>\Pad::_STATUS_NORMAL,
            '`Record_Store`.`status`'=>\Store::_STATUS_NORMAL,
        ));
        $criteria->order = 't.up_time desc';
        $criteria->limit = 20;
        $this->errorThrow = false;
        $this->render('index', array(
            'models' => $this->loadModelAll($criteria),
        ));
    }
    
    /**
     * 获取打印小票 获取小票的时候 取消抽奖
     * @param integer $id
     */
    public function actionPrint($id)
    {
        
    }
    
    /**
     * 打印成功
     * @param unknown $id
     */
    public function actionSuccess($id)
    {
        
    }
}