<extend name="Base/common"/>
<block name="style">
    <link href="__CSS__/selfie.css" rel="stylesheet">
</block>
<block name="body">
    <body class="tmm-registration">
    <div class="banner">
        <img src="__IMG__/culture2.png">
        <div class="rule">
            <a href="{:U('Vote/rewards')}">查看奖品及参赛规则</a>
        </div>
    </div>
    <div class="content">
        <div class="con">

            <div class="nameInfo">
                <span class="no">{$racingInfo.id}</span>
                <div class="name">{$racingInfo.nickname}</div>
            </div>
            <div class="ticket">
                <span class="num">{$racingInfo.poll}</span>票<br/>
                排名<span class="num">{$racingInfo.rankInfo.rank}</span>位<br/>
                <neq name="racingInfo['rankInfo']['rank']" value="1">
                距上一名还差<span class="num">{$racingInfo.rankInfo.difPoll}</span>票
                </neq>
            </div>
        </div>
        <div class="intro">
            {$racingInfo.introduce}
        </div>
        <volist name="racingInfo.imgList" id="vo">
            <div class="regImg">
                <img src="__ROOT__/{$vo.img_url}">
            </div>
        </volist>
    </div>
    <div class="regBtn">
        <if condition="$racingInfo['isCanVote'] == true ">
            <a id="voteBtn" class="act" href="javascript:;" data-id="{$racingInfo.id}">为她投票</a>
        <else/>
            <a class="voted" href="javascript:;">今天你已经投票，请明天再来</a>
        </if>

        <if condition="$racingInfo['isApply'] == false ">
            <a class="act" href="{:U('Vote/apply')}">我也来参加</a>
        </if>

        <a class="more" href="{:U('Vote/index')}">查看更多</a>
    </div>



    <div class="bgFilter" style="display: none;"></div>
    <div class="coupon" style="display: none;" id="applySuc">
        <img src="__IMG__/close.png" class="img closeAlert">
        <div class="infoSuc regSuc">
            <div class="regState">
                <div class="info">成功报名</div>
                <div class="share">马上分享到朋友圈呼朋唤友来投票吧！</div>
            </div>
            <div class="txt">赠</div>
            <div class="give-card">
                <div class="left">
                    <div class="price">￥<span>10</span></div>
                    <div class="intro">
                        <p class="txt">获得现金券一张</p>
                    </div>
                </div>
                <div class="right"><a href="http://wap.koudaitong.com/v2/ump/promocard/fetch?alias=n4vo1tpn">点击<br>领取</a></div>
            </div>
        </div>
    </div>
    <div class="coupon" style="display: none;" id="voteSuc">
        <img src="__IMG__/close.png" class="img closeAlert">
        <div class="infoSuc voteSuc">
            <div class="state">投票成功</div>
            <div class="txt">赠</div>
            <div class="give-card">
                <div class="left">
                    <div class="price">￥<span>10</span></div>
                    <div class="intro">
                        <p class="txt">获得现金券一张</p>
                    </div>
                </div>
                <div class="right"><a href="http://wap.koudaitong.com/v2/ump/promocard/fetch?alias=n4vo1tpn">点击<br>领取</a></div>
            </div>
        </div>
    </div>

    </body>
</block>
<block name="script">
    <script src="__STATIC__/layermobile/layer.js"></script>
    <script>
        $(function() {
            function showMsg(title, msg) {
                title = title || '';
                msg = msg || '';
                layer.open({
                    title: title,
                    shadeClose: false,
                    content: msg,
                    style: 'background-color:#fff; color:#ea5336;border:none;border-radius:5px;',
                    time: 1
                });
            }
            var applyFlash = "{$applyFlash}";
            if (applyFlash == 1) {
                $('body').css({'width':'100%', 'height':'100%', 'overflow':'hidden', 'position': 'fixed'});
                $('.bgFilter').show();
                $('#applySuc').show();
            }

            $('.closeAlert').on('click', function() {
                $('body').removeAttr('style');
                $('.bgFilter').hide();
                $(this).parent().hide();
            });

            $('#voteBtn').on('click', function() {
                var $this = $(this);
                var id = $this.attr('data-id');
                $.ajax({
                    type: "POST",
                    url: "{:U('Vote/vote')}",
                    data: {'id':id},
                    success: function(response) {
                        if (response.status == 1) {
                            $('body').css({'width':'100%', 'height':'100%', 'overflow':'hidden', 'position': 'fixed'});
                            $('.bgFilter').show();
                            $('#voteSuc').show();
                            $this.remove();
                            $('.regBtn').prepend('<a class="voted" href="javascript:;">今天你已经投票，请明天再来</a>');
                        } else if (response.status == 2) {
                            showMsg('', response.prompt);
                            $this.remove();
                            $('.regBtn').prepend('<a class="voted" href="javascript:;">今天你已经投票，请明天再来</a>');
                        } else if (response.status == 3) {
                            window.location.href = "{:U('vote/follow')}";
                        } else {
                            showMsg('', response.prompt);
                        }
                    }
                });
            });
        });
    </script>
</block>